\newcommand{\IDLf}[1]{\texttt{\textbf{#1}}}
\newcommand{\IDLa}[1]{\textit{#1}}
\newcommand{\IDLbool}{\texttt{bool}}
\newcommand{\IDLint}{\texttt{int}}
\newcommand{\IDLstr}{\texttt{string}}
\newcommand{\IDLflt}{\texttt{float}}
\newcommand{\IDLopt}[1]{$\langle$ #1 $\rangle$}

\chapter{IDL Postprocessor}

\section{Introduction}

The IDL routines described here have been created for the purpose of
reading, displaying, and manipulating data written by \codename\ to an
HDF5 output file.  These routines are contained within files stored in
the subdirectory \texttt{trunk/unstructured/idl/} in the \codename\ SVN
repository.

\subsubsection{Invoking IDL}

First, IDL must be given access to the postprocessor routines.  This
may be accomplished either by copying the \texttt{*.pro} files in the
repository to the working directory where IDL will be run, or to set
the environment variable \texttt{IDL\_PATH} to include the directory
where these files are located.

The IDL module must first be loaded to run IDL on
\texttt{portal.pppl.gov}.  This is done by
\begin{verbatim}
module load idl
\end{verbatim}
IDL may then be invoked by
\begin{verbatim}
idl
\end{verbatim}
Once IDL is running, the postprocessor routines must be compiled.
This is done by
\begin{verbatim}
.run plot_routines
.run power_spectrum
.run read_h5
\end{verbatim}
The functions and procedures described in the following section are
now ready to use.

\subsubsection{Help In IDL}

IDL has an on-line help system which may be invoked from the IDL
command prompt by
\begin{verbatim}
?
\end{verbatim}
Information about a specific intrinsic IDL routine,
\texttt{<routine>}, may be obtained by
\begin{verbatim}
? <routine>
\end{verbatim}


\subsubsection{Note on function/procedure descriptions}

Functions and procedures in IDL are differentiated by whether a value
is returned (as with functions) or not (as with procedures).  Both
functions and procedures may take ``arguments'' and ``keywords'' as
command line parameters.  In the following descriptions, the arguments
of the function or procedure are shown with the command, and keywords
are listed separately.  Optional arguments are enclosed by square
brackets.  Keywords are always optional.  (This notation differs from
that in the on-line IDL help only in that keywords are not listed with
the command.)  Keywords are specified on the command line by
\begin{verbatim}
<keywordname>=<value>
\end{verbatim}
Writing
\begin{verbatim}
/<keywordname> 
\end{verbatim}
has the same effect as
\begin{verbatim}
<keywordname>=1
\end{verbatim}
and is therefore useful for boolean options.  Some common examples are
given below.


\subsubsection{Common Examples}

To display the field ``psi'' at time slice 1 of file ``C1.h5'',
sampled on a regular $100\times100$ grid, with an overlay of the LCFS
and the mesh,
\begin{verbatim}
plot_field, 'psi', 1, filename='C1.h5', /iso, /lcfs, /mesh, points=100
\end{verbatim}

To plot the time series of the kinetic energy of file ``C1.h5'' in
domain $0 < t < 100$, 
\begin{verbatim}
plot_scalar, 'ke', filename='C1.h5', xrange=[0,100]
\end{verbatim}

To plot the flux-averaged temperature profiles of files ``1/C1.h5''
and ``2/C1.h5'' at time slice 1, versus the normalized poloidal flux,
\begin{verbatim}
plot_flux_average, 'T', 1, filename=['1/C1.h5', '2/C1.h5'], /norm
\end{verbatim}


\section{Functions/Procedures in \IDLf{plot\_routines.pro}}

\subsection{Procedure \IDLf{{contour\_and\_legend}}}

\IDLf{{contour\_and\_legend}}, \IDLa{z} [,\IDLa{x}, \IDLa{y}]

\subsubsection{Description}

This procedure draws a two-dimensional color contour plot of the data
\IDLa{z}, with horizontal and vertical coordinates \IDLa{x} and \IDLa{y}.
\IDLa{nt} frames are drawn.

\subsubsection{Arguments}

\begin{tabular}{lcll}
Name & I/O & Type & Description\\
\hline
\IDLa{z} & I & \IDLflt[\IDLa{nt},\IDLa{nx},\IDLa{nz}] 
                                  & The values of the field to plot\\
\IDLa{x} & I & \IDLflt[\IDLa{nx}] & The values of the $x$-coordinate\\ 
\IDLa{y} & I & \IDLflt[\IDLa{nz}] & The values of the $y$-coordinate\\ 
\end{tabular}


\subsubsection{Keywords}

\begin{tabular}{lclp{2.5in}}
Name            & I/O & Type     & Description\\
\hline
\IDLa{label}   & I & \IDLstr[\IDLa{nt}] 
               & The IDL-formatted label of the color bar for each frame\\
\IDLa{title}   & I & \IDLstr[\IDLa{nt}] 
               & The IDL-formatted title of the plot for each frame\\
\IDLa{range}   & I & \IDLflt[2,\IDLa{nt}]
               & An array of the ranges of $z$ to plot in each frame\\
\IDLa{nlevels} & I & \IDLint[\IDLa{nt}] 
               & The number of contour levels to plot for each frame\\
\IDLa{lines}   & I & \IDLbool[\IDLa{nt}]
               & Whether to draw contour lines for each frame\\
\IDLa{zlog}    & I & \IDLbool[\IDLa{nt}]
               & Whether to draw $z$ on a log scale, for each frame\\
\IDLa{jpeg}    & I & \IDLstr
               & Write the resulting .jpeg image to the file \IDLa{jpeg}\\
\IDLa{isotropic}& I & \IDLbool
               & Use an isotropic aspect ratio when plotting\\
\IDLa{color\_table}& I & \IDLint
               & Which intrinsic IDL color table to use when plotting
\end{tabular}





\section{Functions/Procedures in \IDLf{read\_h5.pro}}




\subsection{Function \IDLf{read\_field}}

\IDLa{field} = \IDLf{read\_field}(\IDLa{name}, \IDLa{r}, \IDLa{z}, \IDLa{t})

\subsubsection{Description}

This function reads the raw field data associated with \IDLa{name} in
the specified output file.  The data is interpolated onto a uniform
retangular grid, and returned in an array.


\subsubsection{Return Value}

\IDLflt[\IDLa{nt}, \IDLa{points}, \IDLa{points}] \IDLa{field}
containing the value of the field at \IDLa{points} $\times$
\IDLa{points} spatial sampling points at \IDLa{nt} time slices.

\subsubsection{Arguments}
\begin{tabular}{lcll}
Name & I/O & Type & Description\\
\hline
\IDLa{name} & I & \IDLstr                & The name of the field to read\\
\IDLa{r}    & O & \IDLflt[\IDLa{points}] & The values of the $r$-coordinate\\ 
\IDLa{z}    & O & \IDLflt[\IDLa{points}] & The values of the $z$-coordinate\\ 
\IDLa{t}    & O & \IDLflt[\IDLa{nt}]     & The values of the $t$-coordinate\\
\end{tabular}

\subsubsection{Keywords}
\begin{tabular}{lclp{2.3in}}
Name            & I/O & Type       & Description\\
\hline
\IDLa{filename} & I   & \IDLstr    
                & The name of the HDF5 file to read\\
\IDLa{points}   & I   & \IDLint
                & Number of sampling points per spatial dimension\\
\IDLa{rrange}   & I   & \IDLflt[2] & Range of $r$-coordinate to read\\
\IDLa{zrange}   & I   & \IDLflt[2] & Range of $z$-coordinate to read\\
\IDLa{h\_symmetry}& I & \IDLopt{1 $|$ -1}
                & Return only left-right \IDLopt{symmetric $|$ anti-symmetric} 
                  part of field\\
\IDLa{v\_symmetry}& I & \IDLopt{1 $|$ -1} 
                & Return only up-down \IDLopt{symmetric $|$ anti-symmetric} 
                  part of field\\
\IDLa{diff}     & I   & \IDLbool   
                & If set, \IDLa{name} should be an array with two filenames.  
                  The difference of the fields from the two files is 
                  returned.\\
\IDLa{slices}   & O   & \IDLopt{\IDLint $|$ \IDLint[2]} 
                & \IDLopt{Time slice $|$ range of~time~slices} to read\\
\IDLa{mesh}     & O   &              & 
\end{tabular}



\subsection{Function \IDLf{flux\_average}}

\IDLa{result} = \IDLf{flux\_average}(\IDLa{field}, \IDLa{slice})

\subsubsection{Description}

This function finds the flux-surface average of the field \IDLa{field}.

\subsubsection{Return Value}

\IDLflt[\IDLa{bins}] \IDLa{result} contains the value of the
flux-averaged field for a range of values of flux.

\subsubsection{Arguments}

\begin{tabular}{lclp{2in}}
Name & I/O & Type & Description\\
\hline
\IDLa{field} & I 
             & \IDLopt{\IDLstr $|$ \IDLflt[1,\IDLa{points},\IDLa{points}]}
             & If \IDLa{field} is type \IDLstr, then read field associated with
               name \IDLa{field}.  Otherwise, \IDLa{field} is taken to contain
               the field data.\\
\IDLa{slice} & I & \IDLint
             & If \IDLa{field} is type \IDLstr, then this is the time slice
               to read.  Otherwise, \IDLa{slice} is ignored.
\end{tabular}

\subsubsection{Keywords}

\IDLf{flux\_average} takes all of the optional arguments for
\IDLf{read\_field}.  In addition, 

\begin{tabular}{lclp{2.5in}}
Name            & I/O & Type       & Description\\
\hline
\IDLa{filename} & I   & \IDLstr    
                & The name of the HDF5 file to read\\
\IDLa{bins}     & I   & \IDLint    
                & Number of bins to subdivide the flux\\
\IDLa{psi}*     & I/O & \IDLflt[1,\IDLa{points},\IDLa{points}]
                & The flux field at the given time slice\\
\IDLa{x}        & I/O & \IDLflt[\IDLa{points}]
                & $r$-coordinate values\\
\IDLa{z}        & I/O & \IDLflt[\IDLa{points}]
                & $z$-coordinate values\\
\IDLa{t}        & I/O & \IDLflt[\IDLa{points}]
                & $t$-coordinate values\\
\IDLa{flux}     & O   & \IDLflt[\IDLa{bins}]
                & The value of the flux for each bin\\
\IDLa{title}    & O   & \IDLstr    
                & The IDL-formatted title of the field\\
\IDLa{symbol}   & O   & \IDLstr     
                & The IDL-formatted symbol of the field\\
\IDLa{units}    & O   & \IDLstr    
                & The IDL-formatted units of the field\\
\end{tabular}
* If \IDLa{psi}, \IDLa{x}, \IDLa{z}, and \IDLa{t} are all provided as
  input, the \IDLf{flux\_average} will not read the flux field itself.




\subsection{Function \IDLf{read\_scalar}}

\IDLa{result} = \IDLf{read\_field}(\IDLa{name})

\subsubsection{Description}

This function reads the scalar quantity associated with \IDLa{name} in
the specified output file.  The data is returned as an array .

\subsubsection{Return Value}

\IDLflt[\IDLa{nt}] \IDLa{result} contains the value of the scalar at
each time step.

\subsubsection{Arguments}

\begin{tabular}{lcll}
Name & I/O & Type & Description\\
\hline
\IDLa{name} & I & \IDLstr                & The name of the scalar to read\\
\end{tabular}

\subsubsection{Keywords}

\begin{tabular}{lcll}
Name            & I/O & Type       & Description\\
\hline
\IDLa{filename} & I   & \IDLstr    & The name of the HDF5 file to read\\
\IDLa{time}     & O   & \IDLflt[\IDLa{nt}] 
                                   & The $t$-coordinate of each element\\
\IDLa{title}    & O   & \IDLstr    & The IDL-formatted title of the scalar\\
\IDLa{symbol}   & O   & \IDLstr    & The IDL-formatted symbol of the scalar\\
\IDLa{units}    & O   & \IDLstr    & The IDL-formatted units of the scalar\\
\end{tabular}





\subsection{Procedure \IDLf{plot\_field}}


\IDLf{plot\_field}, \IDLa{name}, \IDLa{slice}, \IDLa{r}, \IDLa{z}, \IDLa{t}

\subsubsection{Arguments}

\begin{tabular}{lcll}
Name & I/O & Type & Description\\
\hline
\IDLa{name} & I & \IDLstr                & The name of the field to read\\
\IDLa{slice} & I & \IDLstr               & The time slice to read\\
\IDLa{r}    & O & \IDLflt[\IDLa{points}] & The values of the $r$-coordinate\\ 
\IDLa{z}    & O & \IDLflt[\IDLa{points}] & The values of the $z$-coordinate\\ 
\IDLa{t}    & O & \IDLflt[\IDLa{nt}]     & The values of the $t$-coordinate\\
\end{tabular}


\subsubsection{Keywords}

\IDLf{plot\_field} takes all of the optional arguments for
\IDLf{read\_field} and \IDLf{contour\_and\_legend}.  In addition, 

\begin{tabular}{lcll}
Name            & I/O & Type       & Description\\
\hline
\IDLa{xrange}   & I   & \IDLflt[2] & Range of $r$-coordinate to plot\\
\IDLa{yrange}   & I   & \IDLflt[2] & Range of $z$-coordinate to plot\\
\IDLa{lcfs}     & I   & \IDLbool   & Plot LCFS\\
\IDLa{mesh}     & I   & \IDLbool   & Plot mesh
\end{tabular}



\subsection{Procedure \IDLf{plot\_flux\_average}}


\IDLf{plot\_flux\_average}, \IDLa{field}, \IDLa{slice}

\subsubsection{Description}

Plots the flux-surface average of a field as a function of poloidal
flux.  Data from multiple files or multiple times may be plotted at
once.

\subsubsection{Arguments}

\begin{tabular}{lclp{2in}}
Name & I/O & Type & Description\\
\hline
\IDLa{field} & I 
             & \IDLopt{\IDLstr $|$ \IDLflt[1,\IDLa{points},\IDLa{points}]}
             & If \IDLa{field} is type \IDLstr, then read field associated with
               name \IDLa{field}.  Otherwise, \IDLa{field} is taken to contain
               the field data.\\
\IDLa{slice} & I & \IDLint[\IDLa{nt}]
             & If \IDLa{field} is type \IDLstr, then this is the time slice(s)
               to read.  Otherwise, \IDLa{slice} is ignored.
\end{tabular}


\subsubsection{Keywords}

\begin{tabular}{lclp{2.5in}}
Name            & I/O & Type       & Description\\
\hline
\IDLa{filename} & I   & \IDLstr[\IDLa{nfiles}] 
                & Names of HDF5 file(s) to read\\
\IDLa{overplot} & I   & \IDLbool & Plot over previous plot\\
\IDLa{lcfs}     & I   & \IDLbool & Plot LCFS\\
\IDLa{minor\_radius}&I& \IDLbool & Plot against flux-average minor radius\\
\IDLa{normalized\_flux} & I & \IDLbool
                & Plot against normalized flux\\
\IDLa{smooth}   & I   & \IDLint  
                & Boxcar-average final data over neighboring
                  \IDLa{smooth} bins\\
\end{tabular}



\subsection{Procedure \IDLf{plot\_timings}}


\IDLf{plot\_timings}

\subsubsection{Description}

This function plots the relative time spent in various subroutines of
\codename.  This data is only available if $\texttt{itimer} = 1$ was
specified in the input file.

\subsubsection{Keywords}

\IDLf{plot\_flux\_average} takes all of the optional arguments for
\IDLf{flux\_average}.  In addition, 

\begin{tabular}{lcll}
Name            & I/O & Type       & Description\\
\hline
\IDLa{filename} & I   & \IDLstr    & The name of the HDF5 file to read\\
\IDLa{overplot} & I   & \IDLbool   & Draws data over the 
\end{tabular}



\subsection{Procedure \IDLf{write\_geqdsk}}


\IDLf{write\_geqdsk}

\subsubsection{Description}

This procedure writes equilibrium data do disk in the \texttt{geqdsk}
format.

\subsubsection{Arguments}

None.

\subsubsection{Keywords}

\IDLf{write\_geqdsk} takes all of the optional arguments for
\IDLf{read\_field} and \IDLf{read\_parameter}.  In addition, 

\begin{tabular}{lcll}
Name            & I/O & Type       & Description\\
\hline
\IDLa{eqfile}   & I   & \IDLstr  & Filename to output geqdsk data\\
\IDLa{b0}       & I   & \IDLflt  & Normalization of magnetic field, in Gauss\\
\IDLa{l0}       & I   & \IDLflt  & Normalization of length scale, in cm
\end{tabular}
